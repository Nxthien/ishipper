if (getCookie("user_id")) {
  var channel = "NotificationChannel";
  App.cable.subscriptions.create({
    channel: channel}, {
    received: function(data) {
      if (data.owner !== undefined) {
        content = data.content;
        invoice = data.invoice;
        owner = data.owner;
        notification = owner.name + ' ' + content + ' ' + invoice.name;

        html = '<li class="nht-notification notification-' + data.id + '">';
        html += '<div class="nht-notification-avatar">';
        if (owner.avatar.url !== null) {
          html += '<%= image_tag ' + owner.avatar.url + ', class: "img-responsive" %>';
        } else {
          html += '<%= image_tag "profile.jpg", class: "img-responsive" %>';
        }
        html += '<div class="clearfix"></div></div>';
        html += '<div class="nht-notification-content">';
        html += 'notification<div class="small">' + jQuery.timeago(invoice.created_at) + '</div></div>';
        html += '<div class="clearfix"></div></li>';
        $('.nht-noti-list').prepend(html);

        notification_id = '.notification-' + invoice.id;
        $('.notification-' + data.id).on('click', function() {
          window.location.assign(window.location.origin + '/shop/invoices/' + invoice.id);
        });
      }
    }
  });
}

function getCookie(name) {
  var value = "; " + document.cookie;
  var parts = value.split("; " + name + "=");
  if (parts.length == 2) return parts.pop().split(";").shift();
}


document.addEventListener("turbolinks:load", function() {
  if($('.nht-notifications').length) {
    $('.nht-notifications').hide();
  }

  $('.nht-notification-icon').on('click', function() {
    $('.nht-notifications').toggle();
  });
});
